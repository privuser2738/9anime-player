#!/bin/bash

# Real-time testing script for 9anime player extension

echo "ðŸ”§ 9Anime Player - Real-Time Testing Setup"
echo "=========================================="
echo ""

# Check if Firefox is running
if pgrep -x "firefox" > /dev/null; then
    echo "âœ… Firefox is running"
else
    echo "âŒ Firefox is not running"
    echo "   Starting Firefox..."
    firefox "about:debugging#/runtime/this-firefox" &
    sleep 3
fi

echo ""
echo "ðŸ“‹ Real-Time Testing Steps:"
echo ""
echo "1ï¸âƒ£  LOAD THE EXTENSION:"
echo "   â€¢ Go to: about:debugging#/runtime/this-firefox"
echo "   â€¢ Click 'Load Temporary Add-on'"
echo "   â€¢ Select: $(pwd)/manifest.json"
echo ""
echo "2ï¸âƒ£  OPEN 9ANIME TEST PAGE:"
echo "   Opening test page in 3 seconds..."
sleep 3
firefox "https://9animetv.to/watch/demon-slayer-kimetsu-no-yaiba-47?ep=952" &
echo "   âœ… Test page opening..."
echo ""
echo "3ï¸âƒ£  OPEN BROWSER CONSOLE:"
echo "   â€¢ Press F12 to open Developer Tools"
echo "   â€¢ Click 'Console' tab"
echo "   â€¢ Look for messages starting with: [9Anime Player]"
echo ""
echo "4ï¸âƒ£  RUN DEBUG INSPECTOR:"
echo "   â€¢ Copy the contents of: $(pwd)/debug-inspector.js"
echo "   â€¢ Paste into console and press Enter"
echo "   â€¢ Examine the output to see page structure"
echo ""
echo "5ï¸âƒ£  HOT RELOAD WORKFLOW:"
echo "   a) Edit content.js (or any file)"
echo "   b) Save the file (Ctrl+S)"
echo "   c) Go to about:debugging#/runtime/this-firefox"
echo "   d) Click 'Reload' next to the extension"
echo "   e) Refresh the 9anime page (F5)"
echo "   f) Check console for new logs"
echo ""
echo "ðŸ“Š WHAT TO CHECK IN CONSOLE:"
echo ""
echo "âœ… Extension loaded:"
echo "   [9Anime Player] Content script loaded"
echo ""
echo "âœ… Video found:"
echo "   [9Anime Player] Video element found after X attempts!"
echo ""
echo "âœ… Episode info extracted:"
echo "   [9Anime Player] Extracted info: {anime, episode, episodeId, genres}"
echo ""
echo "âœ… Fullscreen activated:"
echo "   [9Anime Player] Fullscreen activated successfully!"
echo ""
echo "âœ… Next button found:"
echo "   [9Anime Player] Navigation result: {nextUrl, isLast}"
echo ""
echo "ðŸ” DEBUGGING TIPS:"
echo ""
echo "â€¢ If video not found: Check iframe count in console"
echo "â€¢ If fullscreen fails: Click the page first (browser security)"
echo "â€¢ If next episode fails: Run debug inspector to find button structure"
echo "â€¢ Check all logs with: grep '[9Anime Player]' in console filter"
echo ""
echo "ðŸ“ QUICK CONSOLE COMMANDS:"
echo ""
echo "// Check for video"
echo "document.querySelector('video')"
echo ""
echo "// Check iframes"
echo "document.querySelectorAll('iframe').length"
echo ""
echo "// Find Next button"
echo "Array.from(document.querySelectorAll('a, button')).filter(el => el.textContent.toLowerCase().includes('next'))"
echo ""
echo "// Test fullscreen"
echo "document.documentElement.requestFullscreen()"
echo ""
echo "=========================================="
echo "ðŸŽ¬ Ready for testing! Good luck! ðŸš€"
